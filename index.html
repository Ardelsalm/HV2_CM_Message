<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homvogue Udupi: Transition Checklist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #F0F4F8;
            color: #1A202C;
            line-height: 1.6;
        }
        .font-display {
            font-family: 'Teko', sans-serif;
        }

        /* Checklist Table Styles */
        .checklist-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }
        .checklist-table th, .checklist-table td {
            padding: 0.75rem;
            border: 1px solid #E2E8F0; /* Tailwind gray-200 */
            text-align: left;
        }
        .checklist-table th {
            background-color: #E0E0E0; /* Light grey */
            font-weight: 600;
            color: #2C3E50;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .checklist-table tbody tr:nth-child(even) {
            background-color: #F7FAFC; /* Tailwind gray-50 */
        }
        .checklist-table td select, 
        .checklist-table td input[type="number"], 
        .checklist-table td textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #CBD5E0; /* Tailwind gray-300 */
            border-radius: 0.25rem;
            background-color: #FFFFFF;
            font-size: 0.875rem;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }
        .status-completed .status-indicator { background-color: #38A169; } /* Green */
        .status-in-progress .status-indicator { background-color: #D69E2E; } /* Orange */
        .status-not-started .status-indicator { background-color: #E53E3E; } /* Red */
        .status-on-hold .status-indicator { background-color: #A0AEC0; } /* Grey */

        .status-completed { color: #38A169; font-weight: bold; }
        .status-in-progress { color: #D69E2E; font-weight: bold; }
        .status-not-started { color: #E53E3E; font-weight: bold; }
        .status-on-hold { color: #A0AEC0; font-weight: bold; }

        .progress-bar-container {
            width: 100%;
            background-color: #E2E8F0;
            border-radius: 0.25rem;
            height: 8px;
            overflow: hidden;
            margin-top: 4px;
        }
        .progress-bar {
            height: 100%;
            background-color: #3182CE; /* Blue */
            width: 0%;
            border-radius: 0.25rem;
            transition: width 0.3s ease-in-out;
        }
        .progress-bar-completed { background-color: #38A169; } /* Green for 100% */

        /* Responsive table for smaller screens */
        @media (max-width: 767px) {
            .checklist-table, .checklist-table thead, .checklist-table tbody, .checklist-table th, .checklist-table td, .checklist-table tr {
                display: block;
            }
            .checklist-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            .checklist-table tr {
                border: 1px solid #CBD5E0;
                margin-bottom: 1rem;
                border-radius: 0.5rem;
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            }
            .checklist-table td {
                border: none;
                border-bottom: 1px solid #E2E8F0;
                position: relative;
                padding-left: 50%;
                text-align: right;
            }
            .checklist-table td:before {
                content: attr(data-label);
                position: absolute;
                left: 0;
                width: 45%;
                padding-left: 0.75rem;
                font-weight: bold;
                text-align: left;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .checklist-table td:last-child {
                border-bottom: none;
            }
            .checklist-table td select, .checklist-table td input[type="number"], .checklist-table td textarea {
                text-align: right;
            }
            .checklist-table .status-indicator {
                float: left; /* Keep indicator on the left of the label */
                margin-top: 4px;
            }
        }

        /* Loading Spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3182CE;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <header class="bg-gray-800 text-white text-center py-12 px-4">
        <h1 class="font-display text-4xl md:text-5xl uppercase tracking-wider">Homvogue Udupi: Transition Checklist</h1>
        <p class="mt-2 text-lg md:text-xl max-w-3xl mx-auto">Real-time progress tracking for a seamless strategic evolution.</p>
        <p class="mt-2 text-sm text-gray-300">Your User ID: <span id="user-id-display" class="font-bold">Loading...</span></p>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <section class="my-8 bg-white p-6 md:p-8 rounded-lg shadow-xl">
            <header class="text-center mb-8">
                <h2 class="font-display text-4xl md:text-5xl text-blue-600">Transition Checklist: Real-time Progress</h2>
                <p class="mt-2 text-lg">Tracking key tasks for a seamless transition and successful studio launch. Please update status and completion percentage as tasks progress.</p>
                <p class="text-sm text-gray-500 mt-2">All updates are synchronized in real-time across all team members.</p>
            </header>

            <h3 class="font-display text-3xl text-center text-blue-600 mb-6 mt-8">Phase 1: Controlled Exit (Target: July 31, 2025)</h3>
            <div class="overflow-x-auto shadow-md rounded-lg">
                <table class="checklist-table">
                    <thead>
                        <tr>
                            <th>Task</th>
                            <th>Responsible</th>
                            <th>Duration</th>
                            <th>Status</th>
                            <th>Completion (%)</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                    <tbody id="phase1-checklist-body">
                        <!-- Phase 1 Tasks - Initial data (will be overwritten by Firestore) -->
                        <tr data-task-id="P1T1">
                            <td data-label="Task">Inventory Clearance Sale (up to 70% discount)</td>
                            <td data-label="Responsible">Finance, HR, Sales & Marketing</td>
                            <td data-label="Duration">Ongoing (till Jul 31)</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T1', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress" selected>In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="60" onchange="updateTask('P1T1', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T1', 'remarks', this.value);">Aggressive marketing campaigns initiated.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T2">
                            <td data-label="Task">Sales Team Incentives Setup</td>
                            <td data-label="Responsible">Finance, HR, Sales & Marketing (SM)</td>
                            <td data-label="Duration">1 Week</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T2', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed" selected>Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="100" onchange="updateTask('P1T2', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T2', 'remarks', this.value);">Incentive structure finalized and communicated.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T3">
                            <td data-label="Task">Documentation with Landlord (Clearance)</td>
                            <td data-label="Responsible">Finance</td>
                            <td data-label="Duration">2 Weeks</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T3', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress" selected>In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="80" onchange="updateTask('P1T3', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T3', 'remarks', this.value);">Discussions ongoing, positive progress.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T4">
                            <td data-label="Task">Discussion/Intimation with Pragathi Builders</td>
                            <td data-label="Responsible">Finance</td>
                            <td data-label="Duration">1 Day</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T4', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed" selected>Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="100" onchange="updateTask('P1T4', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T4', 'remarks', this.value);">Email sent today, awaiting formal response.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T5">
                            <td data-label="Task">Adjust Rent Dues/Utilities from Advance</td>
                            <td data-label="Responsible">Finance</td>
                            <td data-label="Duration">1 Week</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T5', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress" selected>In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="50" onchange="updateTask('P1T5', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T5', 'remarks', this.value);">Part of ongoing landlord discussions.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T6">
                            <td data-label="Task">Clear TDS and GST ITC, Assets Calculations, GST ITC Transfer, Depreciation on Movable Assets</td>
                            <td data-label="Responsible">Accounts, Finance</td>
                            <td data-label="Duration">2 Weeks</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T6', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P1T6', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T6', 'remarks', this.value);">To be initiated once final figures are clear.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T7">
                            <td data-label="Task">Cancel Lease Agreement</td>
                            <td data-label="Responsible">Finance</td>
                            <td data-label="Duration">2 Weeks</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T7', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P1T7', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T7', 'remarks', this.value);">Dependent on landlord documentation.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T8">
                            <td data-label="Task">Get Clearance from Pragathi Partners</td>
                            <td data-label="Responsible">Finance</td>
                            <td data-label="Duration">3 Weeks</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T8', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P1T8', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T8', 'remarks', this.value);">Will follow up after initial builder intimation.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T9">
                            <td data-label="Task">Demolition of Interiors</td>
                            <td data-label="Responsible">Purchase/Operations</td>
                            <td data-label="Duration">2 Weeks</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T9', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P1T9', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T9', 'remarks', this.value);">Scheduled to begin after major clearance.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T10">
                            <td data-label="Task">Recovery of Reusable Assets</td>
                            <td data-label="Responsible">Purchase/Operations</td>
                            <td data-label="Duration">2 Weeks</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T10', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P1T10', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T10', 'remarks', this.value);">To be coordinated with demolition.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T11">
                            <td data-label="Task">Movement of Remaining Inventories</td>
                            <td data-label="Responsible">Purchase/Operations</td>
                            <td data-label="Duration">1 Week</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T11', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P1T11', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T11', 'remarks', this.value);">Final stage, after clearance sale.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T12">
                            <td data-label="Task">Ethical Relieving of Branch Staff</td>
                            <td data-label="Responsible">HR</td>
                            <td data-label="Duration">Ongoing (till Jul 31)</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T12', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="70" onchange="updateTask('P1T12', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T12', 'remarks', this.value);">Voluntary resignations accepted, process ongoing.</textarea></td>
                        </tr>
                        <tr data-task-id="P1T13">
                            <td data-label="Task">Vigilant Oversight (Prevent Theft)</td>
                            <td data-label="Responsible">Purchase, Operations, Security</td>
                            <td data-label="Duration">Ongoing (till Jul 31)</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P1T13', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="90" onchange="updateTask('P1T13', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P1T13', 'remarks', this.value);">Daily checks in place.</textarea></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 class="font-display text-3xl text-center text-blue-600 mb-6 mt-12">Phase 2: Studio Launch (Target: August 1, 2025)</h3>
            <div class="overflow-x-auto shadow-md rounded-lg">
                <table class="checklist-table">
                    <thead>
                        <tr>
                            <th>Task</th>
                            <th>Responsible</th>
                            <th>Duration</th>
                            <th>Status</th>
                            <th>Completion (%)</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                    <tbody id="phase2-checklist-body">
                        <!-- Phase 2 Tasks -->
                        <tr data-task-id="P2T1">
                            <td data-label="Task">Token Advance for New Property (1600 sq ft)</td>
                            <td data-label="Responsible">Finance</td>
                            <td data-label="Duration">1 Day</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T1', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T1', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P2T1', 'remarks', this.value);">Scheduled for tomorrow.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T2">
                            <td data-label="Task">Secure New Location for Aug 1st Launch</td>
                            <td data-label="Responsible">Finance</td>
                            <td data-label="Duration">1 Week</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T2', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T2', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P2T2', 'remarks', this.value);">Formal lease agreement to be finalized.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T3">
                            <td data-label="Task">Move 2 ACs from Old Showroom</td>
                            <td data-label="Responsible">Purchase/Operations</td>
                            <td data-label="Duration">2 Days</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T3', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T3', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P2T3', 'remarks', this.value);">To be done in last week of July.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T4">
                            <td data-label="Task">Relocate 2-3 Kitchen Units (Ultrafresh)</td>
                            <td data-label="Responsible">Purchase, Accounts, Operations</td>
                            <td data-label="Duration">3 Days</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T4', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T4', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P2T4', 'remarks', this.value);">To be done in last week of July.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T5">
                            <td data-label="Task">Intimate Ultrafresh about Location Move</td>
                            <td data-label="Responsible">Sales & Marketing (SM)</td>
                            <td data-label="Duration">1 Day</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T5', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="100" onchange="updateTask('P2T5', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="updateTask('P2T5', 'remarks', this.value);">Email sent, follow-up call pending.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T6">
                            <td data-label="Task">Coordinate Ultrafresh Branding Relocation</td>
                            <td data-label="Responsible">Sales & Marketing (SM)</td>
                            <td data-label="Duration">1 Week</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T6', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T6', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">SM to liaise with Ultrafresh team.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T7">
                            <td data-label="Task">Interior Designer: Create New Studio Layout</td>
                            <td data-label="Responsible">Interior Designer, Operations</td>
                            <td data-label="Duration">3 Days</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T7', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="70" onchange="updateTask('P2T7', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Detailed floor measurements taken, initial sketches ready.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T8">
                            <td data-label="Task">Design Studio Blueprint (Furniture/Decors)</td>
                            <td data-label="Responsible">Interior Designer</td>
                            <td data-label="Duration">1 Week</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T8', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T8', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Dependent on layout finalization.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T9">
                            <td data-label="Task">Install Two TVs (Design/Ads)</td>
                            <td data-label="Responsible">Sales & Marketing (SM), Operations</td>
                            <td data-label="Duration">2 Days</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T9', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T9', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">To be done during fit-out.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T10">
                            <td data-label="Task">Coordinate Lighting Work</td>
                            <td data-label="Responsible">Purchase/Operations</td>
                            <td data-label="Duration">1 Week</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T10', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T10', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Vendor shortlisting in progress.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T11">
                            <td data-label="Task">Coordinate Painting</td>
                            <td data-label="Responsible">Purchase, Accounts, Operations</td>
                            <td data-label="Duration">4 Days</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T11', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T11', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">To be scheduled.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T12">
                            <td data-label="Task">Coordinate Side Glass Walls</td>
                            <td data-label="Responsible">Purchase, Accounts, Operations</td>
                            <td data-label="Duration">1 Week</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T12', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T12', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Quotation collection.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T13">
                            <td data-label="Task">Coordinate Industrial Works</td>
                            <td data-label="Responsible">Purchase, Accounts, Operations</td>
                            <td data-label="Duration">2 Weeks</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T13', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T13', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Initial vendor discussions.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T14">
                            <td data-label="Task">Actively Seek New Interior/Custom Furniture Leads</td>
                            <td data-label="Responsible">Sales & Marketing, BDO</td>
                            <td data-label="Duration">Ongoing</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T14', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="20" onchange="updateTask('P2T14', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Initial prospecting started during clearance.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T15">
                            <td data-label="Task">Utilize Clearance Sale for Studio Prospects</td>
                            <td data-label="Responsible">Sales & Marketing, BDO</td>
                            <td data-label="Duration">Ongoing (till Jul 31)</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T15', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="40" onchange="updateTask('P2T15', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Identifying potential studio clients from showroom visitors.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T16">
                            <td data-label="Task">SAP Software Modifications (Interior Projects)</td>
                            <td data-label="Responsible">Accounts, Finance, IT</td>
                            <td data-label="Duration">3 Weeks</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T16', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T16', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Requirements gathering to begin.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T17">
                            <td data-label="Task">Accounts: Billing/Barcoding for Custom/Bulk</td>
                            <td data-label="Responsible">Accounts</td>
                            <td data-label="Duration">2 Weeks</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T17', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T17', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">To be defined with SAP modifications.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T18">
                            <td data-label="Task">Plan Initial Sales Campaign (Small Interiors)</td>
                            <td data-label="Responsible">Sales & Marketing</td>
                            <td data-label="Duration">1 Week</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T18', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="50" onchange="updateTask('P2T18', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Campaign brief in progress.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T19">
                            <td data-label="Task">Showcase Previous TV Units/Installations</td>
                            <td data-label="Responsible">Sales & Marketing</td>
                            <td data-label="Duration">1 Week</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T19', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="0" onchange="updateTask('P2T19', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Photography/documentation of past projects needed.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T20">
                            <td data-label="Task">Coordinate Third-Party Production Units</td>
                            <td data-label="Responsible">Purchase, Interior Designer, Accounts, Operations</td>
                            <td data-label="Duration">Ongoing</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T20', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="60" onchange="updateTask('P2T20', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Existing relationships, new vendor onboarding if needed.</textarea></td>
                        </tr>
                        <tr data-task-id="P2T21">
                            <td data-label="Task">Implement "Labour Minimum Required" Mode</td>
                            <td data-label="Responsible">Interior Designer, Purchase, Accounts, Operations</td>
                            <td data-label="Duration">Ongoing</td>
                            <td data-label="Status">
                                <span class="status-indicator"></span>
                                <select onchange="updateTask('P2T21', 'status', this.value);">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="On Hold">On Hold</option>
                                </select>
                            </td>
                            <td data-label="Completion (%)">
                                <input type="number" min="0" max="100" value="80" onchange="updateTask('P2T21', 'completion', this.value);">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                            </td>
                            <td data-label="Remarks"><textarea onchange="saveChecklistData();">Revised project execution protocols being drafted.</textarea></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white text-center py-8 px-4 mt-16">
        <p class="font-bold">Homvogue Udupi: Strategic Evolution</p>
        <p class="text-sm text-gray-400">© 2025 Sabhan Group. All rights reserved.</p>
    </footer>

<script type="module">
    // Firebase SDK imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, collection, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"; // Added getDoc

    // Global Firebase variables (provided by Canvas environment)
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    let db;
    let auth;
    let userId;
    let isAuthReady = false; // Flag to ensure auth is ready before Firestore ops

    // Function to update status styling (color and indicator)
    function updateStatus(selectElement) {
        const row = selectElement.closest('tr');
        const statusCell = selectElement.parentElement;
        statusCell.className = ''; // Clear existing status classes
        statusCell.classList.add('font-bold'); // Add font-bold back
        
        const statusValue = selectElement.value;
        statusCell.classList.add('status-' + statusValue.toLowerCase().replace(' ', '-'));
        
        // Update indicator color
        let indicator = statusCell.querySelector('.status-indicator');
        if (!indicator) { // Create if it doesn't exist (for initial load)
            indicator = document.createElement('span');
            indicator.classList.add('status-indicator');
            statusCell.prepend(indicator);
        }
        indicator.className = 'status-indicator'; // Reset
        indicator.classList.add('status-' + statusValue.toLowerCase().replace(' ', '-'));
    }

    // Function to update completion progress bar
    function updateCompletion(inputElement) {
        const percentage = parseInt(inputElement.value);
        const progressBar = inputElement.nextElementSibling.querySelector('.progress-bar');
        if (progressBar) {
            progressBar.style.width = percentage + '%';
            if (percentage === 100) {
                progressBar.classList.add('progress-bar-completed');
            } else {
                progressBar.classList.remove('progress-bar-completed');
            }
        }
    }

    // Function to update a task in Firestore
    async function updateTask(taskId, field, value) {
        if (!isAuthReady || !userId) {
            console.warn("Firebase not ready or user not authenticated. Cannot update task.");
            return;
        }

        const taskRef = doc(db, 'artifacts', appId, 'public', 'data', 'homvogueChecklist', taskId);
        const updateData = {};
        updateData[field] = value;

        try {
            await setDoc(taskRef, updateData, { merge: true });
            console.log(`Task ${taskId} field ${field} updated to ${value} in Firestore.`);
        } catch (error) {
            console.error("Error updating document: ", error);
        }
    }

    // Function to initialize Firestore listener and populate checklist
    function initFirestoreListener() {
        if (!db || !userId) {
            console.error("Firestore not initialized or userId not available.");
            return;
        }

        const checklistCollectionRef = collection(db, 'artifacts', appId, 'public', 'data', 'homvogueChecklist');
        
        onSnapshot(checklistCollectionRef, (snapshot) => {
            snapshot.docChanges().forEach((change) => {
                const taskData = change.doc.data();
                const taskId = change.doc.id;
                const row = document.querySelector(`tr[data-task-id="${taskId}"]`);

                if (row) {
                    if (change.type === "added" || change.type === "modified") {
                        const statusSelect = row.querySelector('select');
                        const completionInput = row.querySelector('input[type="number"]');
                        const remarksTextarea = row.querySelector('textarea');

                        if (taskData.status && statusSelect) {
                            statusSelect.value = taskData.status;
                            updateStatus(statusSelect);
                        }
                        if (taskData.completion !== undefined && completionInput) {
                            completionInput.value = taskData.completion;
                            updateCompletion(completionInput);
                        }
                        if (taskData.remarks !== undefined && remarksTextarea) {
                            remarksTextarea.value = taskData.remarks;
                        }
                    } else if (change.type === "removed") {
                        // Optional: Handle removal from UI if tasks can be deleted from DB
                        console.log("Task removed:", taskId);
                    }
                } else if (change.type === "added") {
                    // If a new task is added directly to Firestore that isn't in initial HTML
                    // You might want to dynamically create a new row here.
                    console.warn(`Task ${taskId} not found in HTML. Consider dynamic row creation for new tasks.`);
                }
            });
            document.getElementById('loading-overlay').style.display = 'none'; // Hide loading after initial load
        }, (error) => {
            console.error("Error listening to checklist changes: ", error);
            document.getElementById('loading-overlay').style.display = 'none';
        });
    }

    // Initialize Firebase and set up authentication listener
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    document.getElementById('user-id-display').textContent = userId;
                    isAuthReady = true;
                    console.log("Firebase Auth Ready. User ID:", userId);
                    initFirestoreListener(); // Start listening for data changes
                } else {
                    console.log("No user signed in. Attempting anonymous sign-in.");
                    try {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Firebase authentication failed:", error);
                        document.getElementById('user-id-display').textContent = "Auth Error";
                        document.getElementById('loading-overlay').style.display = 'none';
                    }
                }
            });

            // Initial styling for elements (before Firestore data loads)
            document.querySelectorAll('.checklist-table select').forEach(select => updateStatus(select));
            document.querySelectorAll('.checklist-table input[type="number"]').forEach(input => updateCompletion(input));

            // Populate initial data to Firestore if it doesn't exist
            // This is a one-time operation to seed the database if it's empty
            // The onSnapshot listener will then keep it in sync.
            const initialTasks = [];
            document.querySelectorAll('.checklist-table tbody tr').forEach(row => {
                initialTasks.push({
                    taskId: row.dataset.taskId,
                    status: row.querySelector('select').value,
                    completion: parseInt(row.querySelector('input[type="number"]').value),
                    remarks: row.querySelector('textarea').value,
                    responsible: row.querySelector('td[data-label="Responsible"]').textContent,
                    duration: row.querySelector('td[data-label="Duration"]').textContent
                });
            });

            // Check if collection exists and is empty before seeding
            // This is a simplified check, a more robust check might involve querying a specific doc
            const checklistCollectionRef = collection(db, 'artifacts', appId, 'public', 'data', 'homvogueChecklist');
            const initialDocRef = doc(checklistCollectionRef, 'P1T1'); // Check if the first task exists

            // Wait for auth to be ready before attempting to seed data
            const unsubscribeAuth = onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const docSnap = await getDoc(initialDocRef);
                    if (!docSnap.exists()) {
                        console.log("Seeding initial checklist data to Firestore.");
                        for (const task of initialTasks) {
                            await setDoc(doc(checklistCollectionRef, task.taskId), task);
                        }
                    } else {
                        console.log("Checklist data already exists in Firestore. Not seeding.");
                    }
                    unsubscribeAuth(); // Unsubscribe after seeding or confirming data exists
                }
            });

        } catch (error) {
            console.error("Failed to initialize Firebase:", error);
            document.getElementById('user-id-display').textContent = "Init Error";
            document.getElementById('loading-overlay').style.display = 'none';
        }
    });

</script>

</body>
</html>
